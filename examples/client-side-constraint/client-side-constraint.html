<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<title>JS Demo</title>

<style type="text/css" media="all">
	@import "client-side-constraint.css";
</style>
<style>
form .disabled_form_error_message,
fieldset .disabled_error_message {
	display: none;
}

fieldset .button label,
fieldset .content_button label,
fieldset .checkbox label,
fieldset .file label,
fieldset .image label,
fieldset .multi label,
fieldset .password label,
fieldset .radio label,
fieldset .radiogroup label,
fieldset .select label,
fieldset .text label,
fieldset .textarea label
{
	width: 8em;
}

fieldset .label .comment {
	display: inline;
	margin-left: 0.5em;
	color: #666;
	background-color: #ffc;
}
</style>

<script type="text/javascript">
	djConfig = { isDebug: true };
</script>

</head>
<body>
<form action="" enctype="multipart/form-data" id="form" method="post" onsubmit="formfu.id.filter_trimedges('form_username'); formfu.id.reset(); formfu.id.constraint_required('form_username','form_username_constraint_required','form_username_container'); formfu.id.constraint_maxlength('form_username','form_username_constraint_maxlength','form_username_container',8); formfu.id.check_field('form_username','form_username_container'); formfu.id.constraint_required('form_password','form_password_constraint_required','form_password_container'); formfu.id.constraint_minlength('form_password','form_password_constraint_minlength','form_password_container',3); formfu.id.check_field('form_password','form_password_container'); return formfu.id.check_form('form_error_message');">

<div class="disabled_form_error_message" id="form_error_message">
</div>
<script type="text/javascript" src="dojo/dojo.js">
</script>
<script type="text/javascript">
/* load required libraries */
dojo.require("dojo.dom");
dojo.require("dojo.html.common");
dojo.require("dojo.html.util"); // for createNodesFromText()
dojo.require("dojo.collections.Dictionary");

/* our global variable */
var formfu = formfu ? formfu : new Object;
formfu.id = new Object;
formfu.id.errors = new dojo.collections.Dictionary();

/* functions */
formfu.id.reset = function ( field_id ) {
	if ( field_id == undefined ) {
		formfu.id.errors = new dojo.collections.Dictionary();
	}
	else {
		formfu.id.errors.add(field_id, 0);
	}
}

formfu.id.check_field = function ( field_id, container_id ) {
	var container = dojo.byId( container_id );
	var errors    = formfu.id.errors.item(field_id);
	
	if ( errors ) {
		dojo.html.replaceClass(container, 'error', 'disabled_error');
		return false;
	}

	dojo.html.replaceClass(container, 'disabled_error', 'error');
	return true;
}

formfu.id.check_form = function ( message_id ) {
	var errors  = formfu.id.errors.getKeyList();
	var message = dojo.byId(message_id);
	
	for ( i=0; i<=errors.length-1; i+=1 ) {
		if ( formfu.id.errors.item( errors[i] ) > 0 ) {
			dojo.html.replaceClass(message, 'form_error_message', 'disabled_form_error_message');
			return false;
		}
	}

	dojo.html.replaceClass(message, 'disabled_form_error_message', 'form_error_message');
	return true;
}

formfu.id.filter_trimedges = function ( field_id ) {
	var field = dojo.byId( field_id );
	var value = field.value
	
	value = value.replace(/^\s+/, '');
	value = value.replace(/\s+$/, '');
	
	field.value = value;
}

formfu.id.constraint_required = function ( field_id, message_id, container_id ) {
	var field   = dojo.byId( field_id );
	var message = dojo.byId( message_id );
	var value   = field.value;
	
	if ( field.value == '' ) {
		dojo.html.replaceClass(message, 'error_message', 'disabled_error_message');
		var error = (formfu.id.errors.contains(field_id) ? formfu.id.errors.item(field_id) : 0);
		formfu.id.errors.add(field_id, (error + 1));
	}
	else {
		dojo.html.replaceClass(message, 'disabled_error_message', 'error_message');
	}
}

formfu.id.constraint_integer = function ( field_id, message_id, container_id ) {
	var field   = dojo.byId( field_id );
	var message = dojo.byId( message_id );
	var value   = field.value;
	var regex   = /^\d*$/;
	
	if ( field.value != '' && ! regex.exec( value ) ) {
		dojo.html.replaceClass(message, 'error_message', 'disabled_error_message');
		var error = (formfu.id.errors.contains(field_id) ? formfu.id.errors.item(field_id) : 0);
		formfu.id.errors.add(field_id, (error + 1));
	}
	else {
		dojo.html.replaceClass(message, 'disabled_error_message', 'error_message');
	}
}

formfu.id.constraint_min = function ( field_id, message_id, container_id, min ) {
	var field   = dojo.byId( field_id );
	var message = dojo.byId( message_id );
	
	if ( field.value != '' && field.value < min ) {
		dojo.html.replaceClass(message, 'error_message', 'disabled_error_message');
		var error = (formfu.id.errors.contains(field_id) ? formfu.id.errors.item(field_id) : 0);
		formfu.id.errors.add(field_id, (error + 1));
	}
	else {
		dojo.html.replaceClass(message, 'disabled_error_message', 'error_message');
	}
}

formfu.id.constraint_minlength = function ( field_id, message_id, container_id, min ) {
	var field   = dojo.byId( field_id );
	var message = dojo.byId( message_id );
	
	if ( field.value != '' && field.value.length < min ) {
		dojo.html.replaceClass(message, 'error_message', 'disabled_error_message');
		var error = (formfu.id.errors.contains(field_id) ? formfu.id.errors.item(field_id) : 0);
		formfu.id.errors.add(field_id, (error + 1));
	}
	else {
		dojo.html.replaceClass(message, 'disabled_error_message', 'error_message');
	}
}

formfu.id.constraint_maxlength = function ( field_id, message_id, container_id, max ) {
	var field   = dojo.byId( field_id );
	var message = dojo.byId( message_id );
	
	if ( field.value != '' && field.value.length > max ) {
		dojo.html.replaceClass(message, 'error_message', 'disabled_error_message');
		var error = (formfu.id.errors.contains(field_id) ? formfu.id.errors.item(field_id) : 0);
		formfu.id.errors.add(field_id, (error + 1));
	}
	else {
		dojo.html.replaceClass(message, 'disabled_error_message', 'error_message');
	}
}

formfu.id.constraint_equal = function ( field_id, message_id, container_id, target_id ) {
	var field   = dojo.byId( field_id );
	var target  = dojo.byId( target_id );
	var message = dojo.byId( message_id );
	
	if ( field.value == target.value ) {
		dojo.html.replaceClass(message, 'disabled_error_message', 'error_message');
	}
	else {
		dojo.html.replaceClass(message, 'error_message', 'disabled_error_message');
		var error = (formfu.id.errors.contains(field_id) ? formfu.id.errors.item(field_id) : 0);
		formfu.id.errors.add(field_id, (error + 1));
	}
}

formfu.id.append_error_message = function ( message_id, message ) {
	var target = dojo.byId(message_id);
	var nodes  = dojo.html.createNodesFromText(message);
	for ( i=0; i<=nodes.length-1; i+=1 )
		target.appendChild(nodes[i]);
}

/* form_error_message */
formfu.id.append_error_message('form_error_message','There were errors with your submission, see below for details');
</script>

<fieldset>
<legend>Form 1</legend>

<span class="text label disabled_error error_constraint_required" id="form_username_container">
<span class="disabled_error_message error_constraint_required" id="form_username_constraint_required">
</span>
<span class="disabled_error_message error_constraint_maxlength" id="form_username_constraint_maxlength">
</span>
<label>Username</label>
<input name="username" type="text" id="form_username" onblur="formfu.id.filter_trimedges('form_username'); formfu.id.reset('form_username'); formfu.id.constraint_required('form_username','form_username_constraint_required','form_username_container'); formfu.id.constraint_maxlength('form_username','form_username_constraint_maxlength','form_username_container',8); formfu.id.check_field('form_username','form_username_container');" />
<span class="comment">
filters[trimedges], constraints[required, maxlength(8)]
</span>
</span>
<script type="text/javascript">
formfu.id.append_error_message('form_username_constraint_required', 'This field is required');
formfu.id.append_error_message('form_username_constraint_maxlength', 'Maximum length of 8 characters');
</script>

<span class="password label disabled_error error_constraint_required error_constraint_minlength" id="form_password_container">
<span class="disabled_error_message error_constraint_required" id="form_password_constraint_required">
</span>
<span class="disabled_error_message error_constraint_minlength" id="form_password_constraint_minlength">
</span>
<label>Password</label>
<input name="password" type="password" id="form_password" onblur="formfu.id.reset('form_password'); formfu.id.constraint_required('form_password','form_password_constraint_required','form_password_container'); formfu.id.constraint_minlength('form_password','form_password_constraint_minlength','form_password_container',3); formfu.id.check_field('form_password','form_password_container');" />
<span class="comment">
constraints[required, minlength(3)]
</span>
</span>
<script type="text/javascript">
formfu.id.append_error_message('form_password_constraint_required', 'This field is required');
formfu.id.append_error_message('form_password_constraint_minlength', 'Minimum length of 3 characters');
</script>

<span class="password label disabled_error error_constraint_equal" id="form_repeat_password_container">
<span class="disabled_error_message error_constraint_equal" id="form_repeat_password_constraint_equal">
</span>
<label>Repeat Password</label>
<input name="repeat_password" type="password" id="form_repeat_password" onblur="formfu.id.reset('form_repeat_password'); formfu.id.constraint_equal('form_repeat_password','form_repeat_password_constraint_equal','form_repeat_password_container','form_password'); formfu.id.check_field('form_repeat_password','form_repeat_password_container');" />
<span class="comment">
constraints[equal(password)]
</span>
</span>
<script type="text/javascript">
formfu.id.append_error_message('form_repeat_password_constraint_equal', 'Must be the same as \'Password\'');
</script>

</fieldset>
<fieldset>

<span class="text label disabled_error error_constraint_required error_constraint_integer error_constraint_min" id="form_age_container">
<span class="disabled_error_message error_constraint_required" id="form_age_constraint_required">
</span>
<span class="disabled_error_message error_constraint_integer" id="form_age_constraint_integer">
</span>
<span class="disabled_error_message error_constraint_min" id="form_age_constraint_min">
</span>
<label>Age</label>
<input name="age" type="text" id="form_age" onblur="formfu.id.reset('form_age'); formfu.id.constraint_required('form_age','form_age_constraint_required','form_age_container'); formfu.id.constraint_integer('form_age','form_age_constraint_integer','form_age_container'); formfu.id.constraint_min('form_age','form_age_constraint_min','form_age_container',18); formfu.id.check_field('form_age','form_age_container');" />
<span class="comment">
constraints[required, integer, min(18)]
</span>
</span>
<script type="text/javascript">
formfu.id.append_error_message('form_age_constraint_required', 'This field is required');
formfu.id.append_error_message('form_age_constraint_integer', 'This field must be an integer');
formfu.id.append_error_message('form_age_constraint_min', 'Must be at least 18');
</script>

</fieldset>
<fieldset>

</fieldset>
<fieldset>

<span class="submit">
<input name="submit" type="submit">
</span>
</fieldset>
</form>

<!-- FORM 2 -->
<form action="" enctype="multipart/form-data" id="form" method="post" onsubmit="formfu.id2.reset(); formfu.id2.constraint_required('form2_username','form2_username_constraint_required','form2_username_container'); formfu.id2.constraint_maxlength('form2_username','form2_username_constraint_maxlength','form2_username_container',8); formfu.id2.check_field('form2_username','form2_username_container'); return formfu.id2.check_form('form2_error_message');">

<div class="disabled_form_error_message" id="form2_error_message">
</div>
<script type="text/javascript" src="dojo/dojo.js">
</script>
<script type="text/javascript">
/* load required libraries */
dojo.require("dojo.dom");
dojo.require("dojo.html.common");
dojo.require("dojo.html.util"); // for createNodesFromText()
dojo.require("dojo.collections.Dictionary");

/* our global variable */
var formfu = formfu ? formfu : new Object;
formfu.id2 = new Object;
formfu.id2.errors = new dojo.collections.Dictionary();

/* functions */
formfu.id2.reset = function ( field_id ) {
	if ( field_id == undefined ) {
		formfu.id2.errors = new dojo.collections.Dictionary();
	}
	else {
		formfu.id2.errors.add(field_id, 0);
	}
}

formfu.id2.check_field = function ( field_id, container_id ) {
	var container = dojo.byId( container_id );
	var errors    = formfu.id2.errors.item(field_id);
	
	if ( errors ) {
		dojo.html.replaceClass(container, 'error', 'disabled_error');
		return false;
	}

	dojo.html.replaceClass(container, 'disabled_error', 'error');
	return true;
}

formfu.id2.check_form = function ( message_id ) {
	var errors  = formfu.id2.errors.getKeyList();
	var message = dojo.byId(message_id);
	
	for ( i=0; i<=errors.length-1; i+=1 ) {
		if ( formfu.id2.errors.item( errors[i] ) > 0 ) {
			dojo.html.replaceClass(message, 'form_error_message', 'disabled_form_error_message');
			return false;
		}
	}

	dojo.html.replaceClass(message, 'disabled_form_error_message', 'form_error_message');
	return true;
}

formfu.id2.constraint_required = function ( field_id, message_id, container_id ) {
	var field   = dojo.byId( field_id );
	var message = dojo.byId( message_id );
	var value   = field.value;
	
	if ( value.length == 0 ) {
		dojo.html.replaceClass(message, 'error_message', 'disabled_error_message');
		var error = (formfu.id2.errors.contains(field_id) ? formfu.id2.errors.item(field_id) : 0);
		formfu.id2.errors.add(field_id, (error + 1));
	}
	else {
		dojo.html.replaceClass(message, 'disabled_error_message', 'error_message');
	}
}

formfu.id2.constraint_maxlength = function ( field_id, message_id, container_id, max ) {
	var field   = dojo.byId( field_id );
	var message = dojo.byId( message_id );
	
	if ( field.value.length > max ) {
		dojo.html.replaceClass(message, 'error_message', 'disabled_error_message');
		var error = (formfu.id2.errors.contains(field_id) ? formfu.id2.errors.item(field_id) : 0);
		formfu.id2.errors.add(field_id, (error + 1));
	}
	else {
		dojo.html.replaceClass(message, 'disabled_error_message', 'error_message');
	}
}

formfu.id2.append_error_message = function ( message_id, message ) {
	var target = dojo.byId(message_id);
	var nodes  = dojo.html.createNodesFromText(message);
	for ( i=0; i<=nodes.length-1; i+=1 )
		target.appendChild(nodes[i]);
}

/* form2_error_message */
formfu.id2.append_error_message('form2_error_message','There were errors with your submission, see below for details');
</script>

<fieldset>
<legend>Form 2</legend>

<span class="text label disabled_error error_constraint_required" id="form2_username_container">
<span class="disabled_error_message error_constraint_required" id="form2_username_constraint_required">
</span>
<span class="disabled_error_message error_constraint_maxlength" id="form2_username_constraint_maxlength">
</span>
<label>Username</label>
<input name="username" type="text" id="form2_username" onblur="formfu.id2.reset('form2_username'); formfu.id2.constraint_required('form2_username','form2_username_constraint_required','form2_username_container'); formfu.id2.constraint_maxlength('form2_username','form2_username_constraint_maxlength','form2_username_container',8); formfu.id2.check_field('form2_username','form2_username_container');" />
<span class="comment">
constraints[required, maxlength(8)]
</span>
</span>
<script type="text/javascript">
formfu.id2.append_error_message('form2_username_constraint_required', 'This field is required');
formfu.id2.append_error_message('form2_username_constraint_maxlength', 'Maximum length of 8 characters');
</script>

<span class="submit">
<input name="submit" type="submit">
</span>
</fieldset>
</form>


</body>
</html>
